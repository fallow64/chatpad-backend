<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Chatpad Auth Testing</title>
    </head>
    <style>
        body {
            max-width: 100vw;
        }

        br {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        #output-div {
            display: block;
        }

        .code {
            font-size: 16px;
            width: 80%;
            max-width: 1920px;
            background-color: rgb(36, 47, 61);
            color: white;
            padding: 10px;
            overflow-x: scroll;
        }
    </style>
    <script>
        /** @type HTMLInputElement */
        let usernameInput;
        /** @type HTMLInputElement */
        let passwordInput;
        /** @type HTMLPreElement */
        let output;
        window.addEventListener("load", () => {
            usernameInput = document.getElementById("username");
            passwordInput = document.getElementById("password");
            output = document.getElementById("output-div");
        });

        function syntaxHighlight(json) {
            if (typeof json != "string") {
                json = JSON.stringify(json, undefined, 2);
            }
            json = json
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
            return json.replace(
                /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
                function (match) {
                    var cls = "number";
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = "key";
                        } else {
                            cls = "string";
                        }
                    } else if (/true|false/.test(match)) {
                        cls = "boolean";
                    } else if (/null/.test(match)) {
                        cls = "null";
                    }
                    return '<span class="' + cls + '">' + match + "</span>";
                }
            );
        }

        function sendOutput(outputObject) {
            const prettified = syntaxHighlight(outputObject);

            const codeSegment = document.createElement("pre");
            codeSegment.className = "code";
            codeSegment.innerHTML = prettified;

            output.insertBefore(codeSegment, output.firstChild);
        }

        async function register() {
            const registerResponse = await fetch("/api/auth/register", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    username: usernameInput.value,
                    password: passwordInput.value,
                }),
            });

            const result = await registerResponse.json();
            console.log(result);
            sendOutput(result);
        }

        async function login() {
            const loginResponse = await fetch("/api/auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    username: usernameInput.value,
                    password: passwordInput.value,
                }),
            });

            const result = await loginResponse.json();
            console.log(result);
            sendOutput(result);
        }

        async function me() {
            const loginResponse = await fetch("/api/auth/me");

            const result = await loginResponse.json();
            console.log(result);
            sendOutput(result);
        }
    </script>
    <body>
        <input id="username" type="text" autocomplete="off" />
        <input id="password" type="text" autocomplete="off" />
        <br />
        <button id="button-register" onclick="register()">Register</button>
        <button id="button-login" onclick="login()">Login</button>
        <button id="button-me" onclick="me()">Me</button>

        <div id="output-div"></pre>
    </body>
</html>
